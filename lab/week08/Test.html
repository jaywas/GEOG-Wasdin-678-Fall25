<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>College Station Weekly Temperature Forecast – D3 (Module)</title>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        margin: 20px;
      }

      h1 {
        text-align: center;
      }

      #d3-temp-chart {
        max-width: 800px;
        margin: 30px auto;
      }

      #d3-temp-chart svg {
        border: 1px solid #ccc;
      }
    </style>
  </head>

  <body>
    <h1>College Station Weekly Temperature Forecast – D3.js</h1>
    <div id="d3-temp-chart"></div>

    <!-- Use ES modules here -->
<script type="module">
  // Import D3 as an ES module
  import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

  // -------------------------------------------------
  // Data
  // -------------------------------------------------
  const tempData = [
    { day: "Sat", high: 82, low: 67 },
    { day: "Sun", high: 81, low: 59 },
    { day: "Mon", high: 81, low: 50 },
    { day: "Tue", high: 70, low: 47 },
    { day: "Wed", high: 77, low: 51 },
    { day: "Thu", high: 78, low: 60 },
    { day: "Fri", high: 79, low: 66 },
    { day: "Sat", high: 80, low: 66 },
  ];

  const series = ["High", "Low"];

  // -------------------------------------------------
  // Chart setup
  // -------------------------------------------------
  const margin = { top: 30, right: 40, bottom: 40, left: 50 },
    width = 800 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

  const svg = d3
    .select("#d3-temp-chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

  // x scale for days
  const x0 = d3
    .scaleBand()
    .domain(tempData.map((d) => d.day))
    .range([0, width])
    .padding(0.2);

  // x scale for High/Low within each day
  const x1 = d3
    .scaleBand()
    .domain(series)
    .range([0, x0.bandwidth()])
    .padding(0.05);

  // y scale
  const y = d3
    .scaleLinear()
    .domain([
      40, // a little below the lowest temp
      90, // a little above the highest temp
    ])
    .nice()
    .range([height, 0]);

  const color = d3
    .scaleOrdinal()
    .domain(series)
    .range(["tomato", "steelblue"]); // High = tomato, Low = steelblue


  // Axes
  svg
    .append("g")
    .attr("transform", `translate(0,${height})`)
    .call(d3.axisBottom(x0));

  svg.append("g").call(d3.axisLeft(y));

  // Axis labels
  svg
    .append("text")
    .attr("x", width / 2)
    .attr("y", height + 30)
    .attr("text-anchor", "middle")
    .text("Day");

  svg
    .append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -height / 2)
    .attr("y", -35)
    .attr("text-anchor", "middle")
    .text("Temperature (°F)");

  // Group for each day
  const dayGroups = svg
    .selectAll(".day-group")
    .data(tempData)
    .enter()
    .append("g")
    .attr("class", "day-group")
    .attr("transform", (d) => `translate(${x0(d.day)},0)`);

  // Bars
  dayGroups
    .selectAll("rect")
    .data((d) => [
      { key: "High", value: d.high },
      { key: "Low", value: d.low },
    ])
    .enter()
    .append("rect")
    .attr("x", (d) => x1(d.key))
    .attr("y", (d) => y(d.value))
    .attr("width", x1.bandwidth())
    .attr("height", (d) => height - y(d.value))
    .attr("fill", (d) => color(d.key));

  // Legend
  const legend = svg
    .append("g")
    .attr("transform", `translate(${width - 120}, 0)`);

  series.forEach((name, i) => {
    const g = legend.append("g").attr("transform", `translate(0,${i * 20})`);

    g.append("rect")
      .attr("x", 0)
      .attr("y", 0)
      .attr("width", 12)
      .attr("height", 12)
      .attr("fill", color(name));

    g.append("text")
      .attr("x", 18)
      .attr("y", 10)
      .text(name);
  });
</script>
  </body>
</html>
